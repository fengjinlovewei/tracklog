export default class TrackLog{click;show;obServerList;constructor(e){var{click:e=()=>{},show:t=()=>{}}=e;this.click=e,this.show=t,this.obServerList=[],this.init()}init(){window.addEventListener("click",this.getClickTrack.bind(this),!0);var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;e?new e(e=>{e.forEach(e=>{for(var t of e.addedNodes)1===t.nodeType&&(this.bindShow(t),Array.from(t.querySelectorAll("[data-trackshow]")).forEach(e=>{this.bindShow(e)}))})}).observe(document.getElementsByTagName("body")[0],{childList:!0,subtree:!0}):console.error("TrackLog 依赖的MutationObserver缺失！")}bindShow(e){if((e.dataset||{}).trackshow)return this.obServerView(e)}getClickTrack(e){let t=e.target;for(;t;){if("html"===(t?.tagName||"").toLowerCase())break;var r=(t.dataset||{}).trackclick;r&&"false"!==r&&this.click?.(r),t=t.parentNode}}getShowTrack(e){e=(e.dataset||{}).trackshow;e&&"false"!==e&&this.show?.(e)}obServerView(t){if(t&&!(-1<this.obServerList.indexOf(t))){this.obServerList.push(t);const r=new IntersectionObserver(e=>{.8<=e[0].intersectionRatio&&(this.getShowTrack(t),this.obServerList.filter(e=>e!==t),r.unobserve(t))},{threshold:.8});r.observe(t)}}}